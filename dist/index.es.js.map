{"version":3,"file":"index.es.js","sources":["../src/linkedList/getNextSiblings.ts","../src/linkedList/getChildItems.ts","../src/linkedList/getItemsBetween.ts","../src/linkedList/getNextItem.ts","../src/linkedList/getNextOrChildById.ts","../src/linkedList/getNextOrChildByTarget.ts","../src/linkedList/getChildAndNextSiblingData.ts","../src/linkedList/getLastChild.ts","../src/linkedList/upsertAndReturnRoot.ts","../src/linkedList/item.ts","../src/linkedList/validateList.ts","../src/linkedList/sortList.ts","../src/linkedList/itemContainer.ts","../src/linkedList/command.ts","../node_modules/uuid/dist/esm-browser/rng.js","../node_modules/uuid/dist/esm-browser/stringify.js","../node_modules/uuid/dist/esm-browser/native.js","../node_modules/uuid/dist/esm-browser/v4.js","../src/utils.ts","../src/eventHandler/eventHandler.ts","../src/undoManager/undoManager.ts","../src/saveManager/saveManager.ts","../src/keyboardShortcut/getShortcutString.ts","../src/keyboardShortcut/getFormattedShortcuts.ts","../src/keyboardShortcut/getDistinctShortcuts.ts","../src/keyboardShortcut/keyboardShortcut.ts","../src/icon/arrow.ts","../src/icon/file.ts","../src/icon/text.ts","../src/icon/icons.ts","../src/icon/index.ts","../src/dom/onceClickOutside.ts"],"sourcesContent":["import { Item } from \"./item\";\n\nexport function getNextSiblings<T extends Item<T, any>>(item: T): T[] {\n    if (item.nextItem) return [item.nextItem as T, ...getNextSiblings(item.nextItem) as T[]];\n    else return [];\n}","import { getNextSiblings } from \"./getNextSiblings\";\nimport { Item } from \"./item\";\n\n\nexport function getChildItems<T extends Item<T, any>>(item: T): T[] {\n    if (!item.firstChildItem) return [];\n    return [\n        item.firstChildItem as T,\n        ...getChildItems(item.firstChildItem) as T[],\n        ...getNextSiblings(item.firstChildItem).flatMap(x => [x as T, ...getChildItems<T>(x as T)])\n    ]\n}\n\n\n","import { Item } from \"./item\";\n\nfunction searchItems<T extends Item<T, any>>(item: T, end: T, ignoreChildren: boolean = false): T[] {\n    if (item == undefined) return [];\n    if (item.id == end.id) return [end];\n\n    const children = ignoreChildren ? [] : searchItems<T>(item.firstChildItem! as T, end);\n    if (children.slice(-1)[0]?.id == end.id) return [item, ...children];\n\n    if (item.nextItem) return [item, ...children, ...searchItems<T>(item.nextItem as T, end)];\n    if (item.parentItem) return [item, ...children, ...searchItems<T>(item.parentItem as T, end, true) as T[]].filter(x => x.id != item.parentItem!.id);\n\n    throw Error(\"Something went wrong. Please make sure that the start, and the end has a common parent\")\n\n}\n\n\nexport function getItemsBetween<T extends Item<T, any>>(start: T | undefined, end: T): T[] {\n    return searchItems(start!, end);\n}","import { Item } from \"./item\";\n\n/** The next block can either be the first child, the next sibling or the next sibling of a parent */\nexport function getNextItem<T extends Item<T, any>>(item: T, options?: { ignoreChildren: boolean }): T | undefined {\n\n    if (item.firstChildItem && options?.ignoreChildren != true) return item.firstChildItem as T;\n    if (item.nextItem) return item.nextItem as T;\n\n    function getParentNext(block: T): T | undefined {\n        if (block.nextItem) return block.nextItem as T;\n        if (block.parentItem) return getParentNext(block.parentItem as T);\n        return undefined;\n    }\n\n    return getParentNext(item)\n}","import { Item } from \"./item\";\n\nexport function getNextOrChildById<T extends Item<T, any>>(root: T, id: string): T | undefined {\n\n    function search(item: T): T | undefined {\n        if (item.id == id) return item;\n\n        let response: T | undefined;\n        if (item.firstChildItem) response ||= search(item.firstChildItem as T);\n        if (item.nextItem) response ||= search(item.nextItem as T);\n\n        return response;\n    }\n\n    return search(root)\n}","import { ItemElement } from \"./item\";\n\n\n\nexport function getNextOrChildByTarget<T extends ItemElement<any, T>>(root: T, target: Node): T | undefined {\n    if (target.contains(root.target)) return undefined;\n\n    function search(item: T): T | undefined {\n        \n        let response: T | undefined;\n        if (item.firstChildItem) response ||= search(item.firstChildItem);\n        if (item.nextItem) response ||= search(item.nextItem);\n        if (item.target.contains(target)) response ||= item;\n\n        return response;\n    }\n    \n    return search(root)\n}\n","import { ItemData, ItemElement } from \"./item\";\n\nexport function getChildAndNextSiblingData<TData extends ItemData<any>, T extends ItemElement<any, T>>(item: T): TData[] {\n    if (!item) return [];\n\n    const response = [\n        item.getDetails() as TData\n    ];\n\n    if (item.firstChildItem) response.push(...getChildAndNextSiblingData<TData, T>(item.firstChildItem));\n    if (item.nextItem) response.push(...getChildAndNextSiblingData<TData, T>(item.nextItem));\n\n    return response;\n}","import { Item } from \"./item\";\n\n/** The next block can either be the first child, the next sibling or the next sibling of a parent */\nexport function getLastChild<T extends Item<T, any>>(item: T): T | undefined {\n\n    function _getLastChild(item: T | undefined): T | undefined {\n        if (item?.nextItem) return _getLastChild(item.nextItem);\n        if (item?.firstChildItem) return _getLastChild(item.firstChildItem);\n        return item;\n    }\n\n    return _getLastChild(item?.firstChildItem)\n}","import { getNextOrChildById } from \"./getNextOrChildById\";\nimport { ActionableItem, ItemData } from \"./item\";\n\n\nexport function upsertAndReturnRoot<\n    TData,\n    TItemData extends ItemData<TData>,\n    TItem extends ActionableItem<TData, TItem>,\n>(\n    data: TItemData,\n    root: TItem | undefined,\n    createItem: (data: TItemData) => TItem\n): TItem {\n    if (root == undefined && (data.parentId || data.previousId)) {\n        throw new Error(\"the initial upsert must be the root window\");\n    }\n\n    type AItem = ActionableItem<TData, AItem>;\n    let item = root && getNextOrChildById(<AItem>root, data.id);\n\n    if (item == undefined\n        || item.parentItem?.id != data.parentId\n        || item.previousItem?.id != data.previousId\n    ) {\n        if (root && item && root.id == item.id) {\n            if (item!.firstChildItem) {\n                root = <TItem>item!.firstChildItem;\n            }\n            else if (item!.nextItem) root = <TItem>item!.nextItem;\n            else throw new Error(\"Failed to render block, a new rootBlock could not be determined\");\n        }\n\n        if (item == undefined) item = createItem(data)\n        item?.remove();\n\n\n        if (root == undefined) {\n            root = <TItem>item;\n        }\n        else if (data.previousId) {\n            const previous = getNextOrChildById(<AItem>root, data.previousId);\n            if (!previous) throw new Error(\"Failed to render item, previous item is not rendered\");\n\n            previous.after(item)\n        }\n        else if (data.parentId) {\n            const parent = getNextOrChildById(<AItem>root, data.parentId);\n            if (!parent) throw new Error(\"Failed to render item, parent item is not rendered\");\n\n            parent.append(item)\n        }\n        else {\n            root.before(<TItem>item);\n            root = <TItem>item;\n        }\n    }\n\n    item.update(data.data);\n\n    return root!;\n}","import { getNextSiblings } from \"./getNextSiblings\";\n\n\nexport interface Item<TItem, TData> {\n    get id(): string,\n    get type(): string,\n    get parentItem(): TItem | undefined,\n    get firstChildItem(): TItem | undefined\n    get nextItem(): TItem | undefined,\n    get previousItem(): TItem | undefined\n    get data(): TData | undefined\n}\n\nexport interface ItemData<TData> {\n    id: string,\n    type: string,\n    parentId?: string,\n    previousId?: string,\n    data: TData\n}\n\nexport interface ActionableItem<TData, TItem extends ActionableItem<TData, TItem>> extends Item<TItem, TData> {\n    update(data: TData): void;\n\n    /**\n     * Removes the item and all its children from both the linked list, and the doom render\n     */\n    remove(): void;\n\n    /**\n    * Inserts the item after the last child\n    */\n    append(item: TItem): void;\n\n    /**\n     * Inserts the item just before this item\n     */\n    before(item: TItem): void;\n\n    /**\n     * Inserts the item just after this item\n     */\n    after(item: TItem): void;\n}\n\n/** @internal */\nexport function render(...items: ItemData<any>[]): Item<any, any>[] {\n    const itemById = items.reduce((obj, curr) => {\n        obj[curr.id] = {\n            ...curr,\n            get parentItem() { return obj[curr.parentId!] },\n            get nextItem() { return obj[items.find(x => x.previousId == curr.id)?.id!] },\n            get previousItem() { return obj[curr.previousId!] },\n            get firstChildItem() { return obj[items.find(x => x.parentId == curr.id && x.previousId == undefined)?.id!] },\n            get data() { return curr.data },\n        };\n\n        return obj\n    }, {} as { [key: string]: Item<any, any> })\n\n    return items.map(x => itemById[x.id]);\n}\n\nexport abstract class ItemElement<TData, TItem extends ItemElement<TData, TItem>>\n    implements ActionableItem<TData, TItem> {\n\n    #id: string;\n    get id(): string { return this.#id; }\n\n    #type: string;\n    get type(): string { return this.#type; }\n\n    #parent: TItem | undefined;\n    get parentItem(): TItem | undefined { return this.#parent }\n    // set parentItem(item: TItem | undefined) { this.#parent = item; }\n\n    #firstChild: TItem | undefined;\n    get firstChildItem(): TItem | undefined { return this.#firstChild }\n    // set firstChildItem(item: TItem | undefined) { this.#firstChild = item; }\n\n    #next: TItem | undefined;\n    get nextItem(): TItem | undefined { return this.#next }\n    // set nextItem(item: TItem | undefined) { this.#next = item; }\n\n    #previous: TItem | undefined;\n    get previousItem(): TItem | undefined { return this.#previous }\n    // set previousItem(item: TItem | undefined) { this.#previous = item; }\n\n    abstract get data(): TData\n\n    abstract update(data: TData): void;\n    abstract render(data: TData): HTMLElement;\n\n    #target: HTMLElement | undefined\n    get target(): HTMLElement {\n        if (!this.#target)\n            throw new Error(\"Failed to get target. Please call the .initialized(data) method before fetching the target\");\n\n        return this.#target;\n    }\n\n    init(data: TData): void {\n        if (this.#target)\n            throw new Error(\"The target has already been initialized\");\n\n        this.#target = this.render(data);\n    }\n\n    getDetails(): ItemData<TData> {\n        return {\n            id: this.id,\n            type: this.type,\n            parentId: this.parentItem?.id,\n            previousId: this.previousItem?.id,\n            data: this.data\n        }\n    }\n\n    remove(): void {\n        if (this.parentItem?.firstChildItem?.id == this.id) {\n            this.parentItem.#firstChild = this.#next\n        }\n\n        if (this.previousItem) {\n            this.previousItem.#next = this.#next;\n        }\n        if (this.nextItem) {\n            this.nextItem.#previous = this.#previous;\n        }\n\n        this.#parent = undefined;\n        this.#next = undefined;\n        this.#previous = undefined;\n\n        this.#target?.remove();\n    }\n\n    append(item: TItem): void {\n        if (item.id == this.id) throw new Error(\"Cannot append item before itself\");\n        if (item.target.contains(this.target)) throw new Error(\"Cannot append a parent into one of its children\");\n\n        item.remove();\n\n        const children = this.firstChildItem && [this.firstChildItem, ...getNextSiblings(this.firstChildItem)];\n        const lastChild = children?.slice(-1)[0];\n\n        item.#parent = this as unknown as TItem;\n\n        if (lastChild) {\n            lastChild.after(item);\n        }\n        else {\n            this.#firstChild = item;\n            this.target.append(item.target);\n        }\n    }\n\n    before(item: TItem): void {\n        if (item.id == this.id) throw new Error(\"Cannot append item before itself\");\n        if (item.target.contains(this.target)) throw new Error(\"Cannot append a parent into one of its children\");\n\n\n        item.remove();\n\n        item.#previous = this.previousItem\n        if (this.previousItem) this.previousItem.#next = item;\n        else if (this.parentItem) this.parentItem.#firstChild = item;\n\n        item.#parent = this.parentItem;\n        item.#next = this as unknown as TItem\n        this.#previous = item;\n\n        this.target.before(item.target);\n    }\n\n    after(item: TItem): void {\n        if (item.id == this.id) throw new Error(\"Cannot append item before itself\");\n        if (item.target.contains(this.target)) throw new Error(\"Cannot append a parent into one of its children\");\n\n        item.remove();\n\n        item.#next = this.nextItem;\n        if (this.nextItem) this.nextItem.#previous = item;\n\n        item.#parent = this.parentItem;\n        item.#previous = this as unknown as TItem;\n        this.#next = item;\n\n        this.target.after(item.target);\n    }\n\n    constructor(id: string, type: string) {\n        if ((id?.trim() ?? \"\").length == 0) throw new Error(\"id is required\");\n        if ((type?.trim() ?? \"\").length == 0) throw new Error(\"type is required\");\n\n        this.#id = id\n        this.#type = type\n    }\n}","import { ItemData } from \"./item\";\n\nfunction getLength(data: ItemData<any>[], parentId?: string, previousId?: string): number {\n    const block = data.find(x => x.parentId == parentId && x.previousId == previousId);\n    if (!block) return 0;\n\n    data = data.filter(x => x.id != block.id);\n\n    return 1\n        + getLength(data, block.id, undefined)\n        + getLength(data, parentId, block.id)\n}\n\n\nexport function validateList<T extends ItemData<any>>(items: T[]): void {\n    const rootBlocks = items.filter(x => x.parentId == undefined && x.previousId == undefined);\n\n    if (rootBlocks.length != 1 && items.length > 0)\n        throw new Error(\"Failed to determine the start of the linked list\");\n\n    const ids = items.map(x => x.id);\n    const idDuplicated = ids.some((x, i, a) => a.indexOf(x) != i);\n    if (idDuplicated)\n        throw new Error(\"Found duplicated instances of ids\");\n\n    const prevIds = items.map(x => x.previousId + \"_\" + x.parentId);\n    const prevIdDuplicated = prevIds.some((x, i, a) => a.indexOf(x) != i);\n    if (prevIdDuplicated)\n        throw new Error(\"Some of the items have the same previousId\");\n\n\n    if (getLength(items) != items.length) \n        throw new Error(\"Linked list is not valid\")\n}\n","import { ItemData } from \"./item\";\nimport { validateList } from \"./validateList\";\n\n\nfunction sort<T extends ItemData<any>>(items: T[], parentId: string | undefined, previousId: string | undefined) : T[]{\n    const item = items.find(x => x.parentId == parentId && x.previousId == previousId);\n    if (!item) return [];\n\n    items = items.filter(x => x.id != item.id);\n\n    return [\n        item,\n        ...sort(items, item.id, undefined),\n        ...sort(items, parentId, item.id)\n    ];\n}\n\nexport function sortList<T extends ItemData<any>>(items: T[]): T[] {\n    validateList(items);\n    return sort(items, undefined, undefined)\n}\n\n\n","import { Command } from \"./command\";\nimport { getChildAndNextSiblingData } from \"./getChildAndNextSiblingData\";\nimport { getNextItem } from \"./getNextItem\";\nimport { getNextOrChildById } from \"./getNextOrChildById\";\nimport { getNextOrChildByTarget } from \"./getNextOrChildByTarget\";\nimport { ItemData, ItemElement } from \"./item\";\nimport { sortList } from \"./sortList\";\nimport { upsertAndReturnRoot } from \"./upsertAndReturnRoot\";\nimport { validateList } from \"./validateList\";\n\nexport abstract class ItemContainerElement<\n    TItem extends ItemElement<any, TItem>\n> {\n    #target: HTMLElement;\n    #rootItem: TItem | undefined;\n    get rootItem(): TItem { return this.#rootItem! }\n\n    get activeItem(): TItem | undefined {\n        if (document.activeElement == undefined) return undefined;\n        return getNextOrChildByTarget(this.#rootItem!, document.activeElement)\n    }\n\n    abstract get commands(): Command<ItemContainerElement<TItem>>[]\n\n    constructor(target: HTMLElement) {\n        this.#target = target;\n    }\n\n    get value(): ItemData<any>[] {\n        return getChildAndNextSiblingData(this.#rootItem!);\n    }\n\n    set value(items: ItemData<any>[]) {\n        validateList(items);\n\n        const sortedList = sortList(items);\n        if (sortedList.length != items.length)\n            throw new Error(\"Cannot set value, invalid linked list\");\n\n        const oldRoot = this.#rootItem;\n        items.forEach((item, index) => {\n            this.upsert(item);\n\n            if (index == 0) {\n                this.#target.replaceChildren(this.#rootItem!.target);\n                oldRoot?.remove();\n            }\n        })\n    }\n\n    upsert<T extends ItemData<any>>(data: T): void {\n        this.#rootItem = upsertAndReturnRoot(data, this.#rootItem, () => this.createItem(data.type, data.id, data.data))\n    }\n\n    getItemById(id: string): TItem | undefined {\n        return getNextOrChildById(this.#rootItem!, id);\n    }\n\n    deleteItemById(id: string): void {\n        if (id == this.#rootItem!.id) {\n            const newRootItem = getNextItem(this.rootItem);\n\n            this.getItemById(id)\n                ?.remove();\n\n            this.#rootItem = newRootItem;\n        }\n        else {\n            this.getItemById(id)\n                ?.remove();\n        }\n    }\n\n    abstract createItem<T>(type: string, id: string, data?: T): TItem;\n}\n","\n\nexport abstract class Command<TContext> {\n    abstract get id(): string\n\n    #context: TContext\n    get context(): TContext { return this.#context }\n\n    abstract get active(): boolean\n\n    constructor(context: TContext) {\n        this.#context = context;\n    }\n\n    abstract execute(): void\n}","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import { v4 as uuidv4 } from 'uuid';\n\n/** @internal */\nexport function generateUId(): string {\n    return uuidv4();\n}","import { generateUId } from \"../utils\";\n\nexport type EventFunctions = { preventDefault: () => void };\nexport interface BaseEvent extends EventFunctions { }\n\ntype Event<EventMap, Key extends keyof EventMap, TBaseEvent = BaseEvent> = EventMap[Key] extends TBaseEvent ? EventMap[Key] : never\n\ntype Subscriptions<EventMap, TBaseEvent = BaseEvent> = {\n    [key in keyof EventMap]: {\n        Id: EventListenerId,\n        Execute(data: Omit<Event<EventMap, key, TBaseEvent>, \"preventDefault\">): void\n    }[]\n}\n\nexport type EventListenerId = string;\n\nexport interface EventHandlerAPI<\n    EventMap extends { [key in keyof EventMap]: Omit<Event<EventMap, key, TBaseEvent>, \"preventDefault\"> },\n    TBaseEvent extends EventFunctions = BaseEvent\n> {\n\n    On<Key extends keyof EventMap>(type: Key, handler: (event: Event<EventMap, Key, TBaseEvent>) => void): EventListenerId;\n    Once<Key extends keyof EventMap>(type: Key, handler: (event: Event<EventMap, Key, TBaseEvent>) => void, condition?: (event: Event<EventMap, Key, TBaseEvent>) => boolean): EventListenerId;\n    Off<Key extends keyof EventMap>(type: Key, listener: EventListenerId): void;\n\n    Emit<Key extends keyof EventMap>(type: Key, event: Omit<Event<EventMap, Key, TBaseEvent>, \"preventDefault\">): { preventDefault: boolean };\n}\n\nexport class EventManager<\n    EventMap extends { [key in keyof EventMap]: Omit<Event<EventMap, key, TBaseEvent>, \"preventDefault\"> },\n    TBaseEvent extends EventFunctions = BaseEvent\n>\n    implements EventHandlerAPI<EventMap, TBaseEvent> {\n\n    #listeners = <Subscriptions<EventMap, TBaseEvent>>{}\n\n\n    constructor() {\n\n    }\n\n    On<Key extends keyof EventMap>(type: Key, handler: (event: Event<EventMap, Key, TBaseEvent>) => void): EventListenerId {\n        let id = generateUId();\n\n        this.#listeners[type] = (this.#listeners[type] ?? [])\n            .concat({ Id: id, Execute: handler });\n\n        return id;\n    }\n\n    Once<Key extends keyof EventMap>(type: Key, handler: (event: Event<EventMap, Key, TBaseEvent>) => void, condition?: (event: Event<EventMap, Key, TBaseEvent>) => boolean): EventListenerId {\n        var id = generateUId();\n        this.#listeners[type] = (this.#listeners[type] ?? [])\n            .concat({\n                Id: id,\n                Execute: (data: Event<EventMap, Key, TBaseEvent>) => {\n                    if (condition && condition(data) != true) return;\n\n                    this.Off(type, id);\n                    handler(data);\n                }\n            });\n        return id;\n    }\n\n    Off<Key extends keyof EventMap>(type: Key, listenerId: EventListenerId): void {\n        const index = this.#listeners[type]?.findIndex(x => x.Id == listenerId);\n        if (index >= 0) this.#listeners[type].splice(index, 1);\n    }\n\n    Emit<Key extends keyof EventMap>(type: Key, event: Omit<Event<EventMap, Key, TBaseEvent>, \"preventDefault\">): { preventDefault: boolean } {\n        var response = { preventDefault: false };\n\n        this.#listeners[type]\n            ?.slice()\n            .forEach(x => x.Execute({\n                ...event,\n                preventDefault() { response.preventDefault = true }\n            }));\n\n        return response;\n    }\n}\n","export interface ExecuteState {\n    Undo(): void;\n    BeforeUndo?(): void;\n    OnUndo?(): void;\n\n    Action(): void;\n    BeforeAction?(): void;\n    OnAction?(): void;\n}\n\nexport interface UndoAPI {\n    get HistoryIndex(): number;\n\n    Execute(state: ExecuteState): void;\n\n    CanUndo(): boolean;\n    Undo(): void;\n\n    CanRedo(): boolean;\n    Redo(): void;\n}\n\nexport interface UndoOptions {\n    OnAction?: (() => void)\n}\n\nexport function UndoManager(options?: UndoOptions): UndoAPI {\n    const history: {\n        Undo(): void,\n        BeforeUndo?(): void,\n        OnUndo?(): void,\n\n        Redo(): void,\n        BeforeRedo?(): void,\n        OnRedo?(): void\n    }[] = [];\n    var historyIndex: number = -1;\n\n    const OnAction = options?.OnAction ?? (() => { })\n\n    function Undo(): void {\n        if (!CanUndo()) return;\n\n        const state = history[historyIndex];\n        historyIndex--;\n\n        state.BeforeRedo?.()\n        state.Undo()\n        state.OnUndo?.()\n        OnAction();\n    }\n\n    function Redo(): void {\n        if (!CanRedo()) return;\n\n        historyIndex++;\n        var state = history[historyIndex];\n\n        state.BeforeRedo?.()\n        state.Redo()\n        state.OnRedo?.()\n        OnAction();\n    }\n\n    function Execute(state: ExecuteState): void {\n        if (historyIndex < history.length - 1)\n            history.splice(historyIndex, history.length - historyIndex);\n\n        history.push({\n            Undo: () => state.Undo(),\n            BeforeUndo: () => state.BeforeUndo?.(),\n            OnUndo: () => state.OnUndo?.(),\n\n            Redo: () => state.Action(),\n            BeforeRedo: () => state.BeforeAction?.(),\n            OnRedo: () => state.OnAction?.(),\n        });\n\n        historyIndex = history.length - 1;\n        state.BeforeAction?.();\n        state.Action();\n        state.OnAction?.();\n        OnAction();\n    }\n\n    function CanRedo(): boolean {\n        return historyIndex < history.length - 1\n    }\n    function CanUndo(): boolean {\n        return historyIndex >= 0\n    }\n\n\n    return {\n        get HistoryIndex(): number { return historyIndex },\n        //AddHistory,\n        Execute,\n        Undo,\n        Redo,\n        CanUndo,\n        CanRedo\n    }\n}","import { UndoManager, type UndoAPI } from \"../undoManager\";\n\nexport type SaveAction = \"insert\" | \"update\" | \"delete\";\n\nexport type SaveData<Data extends object> = {\n    Action: SaveAction;\n    Data: Data;\n};\n\nexport interface SaveOptionsData<Data extends object> {\n    items: SaveData<Data>[]\n}\n\nexport interface SaveOptions<Data extends object, TSaveOptionsData extends SaveOptionsData<Data> = SaveOptionsData<Data>> {\n    UndoData: TSaveOptionsData,\n    Data: TSaveOptionsData,\n}\n\nexport interface SaveAPI<Data extends object, TSaveOptions extends SaveOptions<Data> = SaveOptions<Data>> extends Omit<UndoAPI, \"Execute\"> {\n    Save(data: TSaveOptions): void;\n}\n\nexport interface SaveManagerOptions<Data extends object, TSaveOptionsData extends SaveOptionsData<Data> = SaveOptionsData<Data>> {\n    BeforeChanged?(data: TSaveOptionsData): void;\n    OnChanged(data: TSaveOptionsData): void;\n\n    Insert(data: Data): void;\n    Update(data: Data): void;\n    Delete(data: Data): void;\n}\n\nexport class SaveManager<\n    Data extends object,\n    TSaveOptionsData extends SaveOptionsData<Data> = SaveOptionsData<Data>,\n    TSaveOptions extends SaveOptions<Data, TSaveOptionsData> = SaveOptions<Data, TSaveOptionsData>,\n    TSaveManagerOptions extends SaveManagerOptions<Data, TSaveOptionsData> = SaveManagerOptions<Data, TSaveOptionsData>\n> implements SaveAPI<Data> {\n\n    private UndoAPI: UndoAPI;\n    private BeforeChanged: ((data: TSaveOptionsData) => void);\n    private OnChanged: ((data: TSaveOptionsData) => void);\n    private Insert: ((data: Data) => void);\n    private Update: ((data: Data) => void);\n    private Delete: ((data: Data) => void);\n\n    constructor(options: TSaveManagerOptions) {\n        this.UndoAPI = UndoManager();\n        this.BeforeChanged = options.BeforeChanged ?? (() => { });\n        this.OnChanged = options.OnChanged;\n        this.Insert = options.Insert;\n        this.Update = options.Update;\n        this.Delete = options.Delete;\n    }\n\n    CanUndo(): boolean { return this.UndoAPI.CanUndo(); }\n    Undo(): void { this.UndoAPI.Undo(); }\n\n    CanRedo(): boolean { return this.UndoAPI.CanRedo(); }\n    Redo(): void { this.UndoAPI.Redo(); }\n\n    get HistoryIndex(): number  { return this.UndoAPI.HistoryIndex; }\n\n\n    Save(data: TSaveOptions): void {\n        if (!data?.Data || !data?.UndoData) throw new Error(\"Invalid data or undoData\");\n\n        this.UndoAPI.Execute({\n            Undo: () => { this.Execute(data.UndoData); },\n            BeforeUndo: () => { this.BeforeChanged(data.UndoData) },\n            OnUndo: () => { this.OnChanged(data.UndoData) },\n\n            Action: () => { this.Execute(data.Data); },\n            BeforeAction: () => { this.BeforeChanged(data.Data) },\n            OnAction: () => { this.OnChanged(data.Data) }\n        });\n    }\n\n    private Execute(data: SaveOptionsData<Data>): void {\n\n        data.items.forEach(x => ({ \"insert\": this.Insert, \"update\": this.Update, \"delete\": this.Delete, })[x.Action](x.Data))\n    }\n}\n","\n\nexport function getShortcutString(ctrl: boolean, shift: boolean, alt: boolean, key: string) {\n    return [\n        ctrl && \"ctrl\",\n        shift && \"shift\",\n        alt && \"alt\",\n        key\n    ]\n        .filter(x => x)\n        .join(\"+\");\n}\n","import { getShortcutString } from \"./getShortcutString\";\n\n\n\nexport function getFormattedShortcut(shortcut: string): string {\n    return shortcut.toLowerCase()\n        .split(\" \").join(\"\")\n        .split(\",\")\n        .map(str => {\n            const keys = str.split(\"+\");\n            \n            if (keys.filter(x => x.length == 1).length != 1)\n                throw new Error(\"shortcut must contain one letter\");\n\n            if(keys.some(x=> x != \"ctrl\" && x != \"shift\" && x != \"alt\" && x.length != 1))\n                throw new Error(\"The shortcut string contains unrecognizable characters\");\n\n            return getShortcutString(\n                keys.some(x => x == \"ctrl\"),\n                keys.some(x => x == \"shift\"),\n                keys.some(x => x == \"alt\"),\n                keys.find(x => x.length == 1)!\n            );\n        }).join(\",\");\n}\n","import { ShortcutOption } from \"./keyboardShortcut\";\n\n\n\nexport function getDistinctShortcuts<T extends ShortcutOption>(shortcuts: T[]): T[] {\n    return shortcuts.reduce(\n        (arr, curr) => {\n            const index = arr.findIndex(group => group[0].shortcut == curr.shortcut\n                && (group.some(y => y.target.contains(curr.target) || curr.target.contains(y.target)))\n            );\n\n            if (index == -1) arr.push([curr]);\n            else {\n                const hasCloser = arr[index].some(x => x.target.contains(curr.target));\n\n                if (hasCloser) {\n                    arr[index] = arr[index]\n                        .filter(x => x.target.contains(curr.target) == false && curr.target.contains(x.target) == false)\n                        .concat(curr);\n                }\n            }\n            return arr\n        },\n        [] as T[][])\n        .flat()\n}\n","import { getFormattedShortcut } from \"./getFormattedShortcuts\";\nimport { getDistinctShortcuts } from \"./getDistinctShortcuts\";\nimport { getShortcutString } from \"./getShortcutString\";\n\nexport interface ShortcutOption {\n    get disabled(): boolean\n    get target(): HTMLElement\n    get shortcut(): string\n    action: () => void\n}\n\nexport type Shortcut = {\n    ctrl: boolean,\n    shift: boolean,\n    alt: boolean,\n    key: string\n}\n\n\nexport class KeyboardShortcut {\n    #shortcuts: ShortcutOption[] = []\n    #timeoutMs: number;\n\n    constructor(timeoutMs: number = 1000) {\n        this.#timeoutMs = timeoutMs;\n    }\n\n    registerShortcut(target: HTMLElement, shortcut: string, action: () => void, disabled?: () => boolean) {\n        this.#shortcuts.push({\n            target,\n            shortcut: getFormattedShortcut(shortcut),\n            action,\n            get disabled() {\n                return (disabled?.() ?? false)\n            }\n        });\n    }\n\n    #clearKeyStroke() {\n        clearTimeout(this.#currentTimeout);\n        this.#currentKeyStrokes = [];\n    }\n\n    #currentKeyStrokes: string[] = [];\n    #currentTimeout: NodeJS.Timeout | undefined;\n    handleKeystroke(target: HTMLElement, shortcut: Shortcut): void {\n        this.#currentKeyStrokes.push(getShortcutString(shortcut.ctrl, shortcut.shift, shortcut.alt, shortcut.key));\n        const currentKeyStrokes = this.#currentKeyStrokes.join(\",\");\n\n        let matchingShortcuts = getDistinctShortcuts(\n            this.#shortcuts.filter(x =>\n                x.shortcut.startsWith(currentKeyStrokes)\n                && x.disabled == false\n                && x.target.contains(target)\n            )\n        );\n\n\n        clearTimeout(this.#currentTimeout);\n\n        if (matchingShortcuts.length == 0) {\n            this.#clearKeyStroke();\n            return;\n        }\n\n\n        if (matchingShortcuts.length == 1) {\n            this.#clearKeyStroke();\n            matchingShortcuts[0].action();\n        }\n        else {\n            this.#currentTimeout = setTimeout(() => {\n                matchingShortcuts = matchingShortcuts.filter(x => x.shortcut == currentKeyStrokes);\n                this.#clearKeyStroke();\n\n                if (matchingShortcuts.length == 1)\n                    matchingShortcuts[0].action();\n\n            }, this.#timeoutMs)\n        }\n    }\n}","import { IconElement } from \".\";\n\nfunction getChevronRight(): IconElement {\n    // https://www.untitledui.com/free-icons/arrows\n\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"width\", \"100%\");\n    svg.setAttribute(\"height\", \"100%\");\n    svg.setAttribute(\"viewBox\", \"0 0 24 24\");\n    svg.setAttribute(\"fill\", \"none\");\n\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M9 18L15 12L9 6\");\n    path.setAttribute(\"stroke\", \"currentColor\");\n    path.setAttribute(\"stroke-width\", \"2\");\n    path.setAttribute(\"stroke-linecap\", \"round\");\n    path.setAttribute(\"stroke-linejoin\", \"round\");\n\n    svg.appendChild(path);\n\n    return svg;\n}\n\nfunction getChevronDown(): IconElement {\n    // https://www.untitledui.com/free-icons/arrows\n\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"width\", \"100%\");\n    svg.setAttribute(\"height\", \"100%\");\n    svg.setAttribute(\"viewBox\", \"0 0 24 24\");\n    svg.setAttribute(\"fill\", \"none\");\n    \n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M6 9L12 15L18 9\");\n    path.setAttribute(\"stroke\", \"currentColor\");\n    path.setAttribute(\"stroke-width\", \"2\");\n    path.setAttribute(\"stroke-linecap\", \"round\");\n    path.setAttribute(\"stroke-linejoin\", \"round\");\n    \n    svg.appendChild(path);\n\n    return svg;\n}\n\n\n\nexport const ArrowIcons = {\n    \"arrow-chevron-right\": getChevronRight,\n    \"arrow-chevron-down\": getChevronDown,\n}","import { IconElement } from \".\";\n\n\nfunction getFileDocument(): IconElement {\n    // https://www.untitledui.com/free-icons\n\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"width\", \"100%\");\n    svg.setAttribute(\"height\", \"100%\");\n    svg.setAttribute(\"viewBox\", \"0 0 24 24\");\n    svg.setAttribute(\"fill\", \"none\");\n\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M14 2.26953V6.40007C14 6.96012 14 7.24015 14.109 7.45406C14.2049 7.64222 14.3578 7.7952 14.546 7.89108C14.7599 8.00007 15.0399 8.00007 15.6 8.00007H19.7305M16 13H8M16 17H8M10 9H8M14 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H15.2C16.8802 22 17.7202 22 18.362 21.673C18.9265 21.3854 19.3854 20.9265 19.673 20.362C20 19.7202 20 18.8802 20 17.2V8L14 2Z\");\n    path.setAttribute(\"stroke\", \"currentColor\");\n    path.setAttribute(\"stroke-width\", \"2\");\n    path.setAttribute(\"stroke-linecap\", \"round\");\n    path.setAttribute(\"stroke-linejoin\", \"round\");\n\n    svg.appendChild(path);\n\n    return svg\n}\n\n\nexport const FileIcons = {\n    \"file-document\": getFileDocument\n}","import { IconElement } from \".\";\n\nfunction getTextBold(): IconElement {\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"width\", \"16\");\n    svg.setAttribute(\"height\", \"16\");\n    svg.setAttribute(\"fill\", \"currentColor\");\n    svg.setAttribute(\"class\", \"bi bi-type-bold\");\n    svg.setAttribute(\"viewBox\", \"0 0 16 16\");\n\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.673zm0 6.788V8.598h1.73c1.217 0 1.88.492 1.88 1.415 0 .943-.643 1.449-1.832 1.449H5.907z\");\n\n    svg.appendChild(path);\n\n    return svg;\n}\n\nfunction getTextItalic(): IconElement {\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"width\", \"16\");\n    svg.setAttribute(\"height\", \"16\");\n    svg.setAttribute(\"fill\", \"currentColor\");\n    svg.setAttribute(\"class\", \"bi bi-type-italic\");\n    svg.setAttribute(\"viewBox\", \"0 0 16 16\");\n\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.06.096 1.128.212 1.005.807L6.57 11.674c-.123.595-.246.71-1.346.806l-.11.52h3.774l.11-.52c-1.06-.095-1.129-.211-1.006-.806z\");\n\n    svg.appendChild(path);\n\n    return svg;\n}\n\nfunction getTextUnderline(): IconElement {\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"width\", \"16\");\n    svg.setAttribute(\"height\", \"16\");\n    svg.setAttribute(\"fill\", \"currentColor\");\n    svg.setAttribute(\"class\", \"bi bi-type-underline\");\n    svg.setAttribute(\"viewBox\", \"0 0 16 16\");\n\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\"d\", \"M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 3.917 3.623s3.917-1.518 3.917-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-2.687 2.57s-2.687-1.08-2.687-2.57zM12.5 15h-9v-1h9z\");\n\n    svg.appendChild(path);\n\n    return svg;\n}\n\nexport const TextIcons = {\n    \"text-bold\": getTextBold,\n    \"text-italic\": getTextItalic,\n    \"text-underline\": getTextUnderline,\n}\n\n","import { ArrowIcons } from \"./arrow\";\nimport { FileIcons } from \"./file\";\nimport { TextIcons } from \"./text\";\n\nexport const Icons = {\n    ...TextIcons,\n    ...ArrowIcons,\n    ...FileIcons,\n} \n","import { Icons } from \"./icons\";\n\nexport interface IconElement\n    extends SVGElement {\n}\n\nexport type IconTypes = keyof typeof Icons\n\nexport function getIcon(type: IconTypes): IconElement {\n    return Icons[type]();\n}","export function onceClickOutside(target: HTMLElement, callback: (event: MouseEvent) => void) {\n    function handler(event: MouseEvent) {\n        if (target.contains(event.target as HTMLElement)) return;\n\n        document.removeEventListener(\"click\", handler)\n        callback(event);\n    }\n\n    document.addEventListener(\"click\", handler);\n}"],"names":["getNextSiblings","item","getChildItems","x","searchItems","end","ignoreChildren","_a","children","getItemsBetween","start","getNextItem","options","getParentNext","block","getNextOrChildById","root","id","search","response","getNextOrChildByTarget","target","getChildAndNextSiblingData","getLastChild","_getLastChild","upsertAndReturnRoot","data","createItem","_b","previous","parent","_id","_type","_parent","_firstChild","_next","_previous","_target","ItemElement","type","__privateAdd","__privateSet","__privateGet","_c","lastChild","getLength","parentId","previousId","validateList","items","i","a","sort","sortList","_rootItem","ItemContainerElement","oldRoot","index","newRootItem","_context","Command","context","getRandomValues","rnds8","rng","byteToHex","unsafeStringify","arr","offset","randomUUID","native","v4","buf","rnds","generateUId","uuidv4","_listeners","EventManager","handler","condition","listenerId","event","UndoManager","history","historyIndex","Undo","CanUndo","state","Redo","CanRedo","Execute","SaveManager","__publicField","getShortcutString","ctrl","shift","alt","key","getFormattedShortcut","shortcut","str","keys","getDistinctShortcuts","shortcuts","curr","group","y","_shortcuts","_timeoutMs","_clearKeyStroke","clearKeyStroke_fn","_currentKeyStrokes","_currentTimeout","KeyboardShortcut","timeoutMs","action","disabled","currentKeyStrokes","matchingShortcuts","__privateMethod","getChevronRight","svg","path","getChevronDown","ArrowIcons","getFileDocument","FileIcons","getTextBold","getTextItalic","getTextUnderline","TextIcons","Icons","getIcon","onceClickOutside","callback"],"mappings":"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","x_google_ignoreList":[14,15,16,17]}